var _0x3c83=['158301YkWqHk','warn','isEmpty','info','ZLHDU','page','2217597oIIrjF','DELETE\x20/users\x20|\x20BATCH\x20Response:\x20','user','66746yrGgCh','underscore','deleteUser','mydb','1hWYNaW','1006945emslCd','GET\x20/transfer/','params','table','5AJtwQx','stringify','replace','exception','exports','{}.constructor(\x22return\x20this\x22)(\x20)','json','root','error','bRwkr','POST\x20/transfers','SUCCESS','__proto__','12108SLnfrQ','push','146096AaqhXm','collection','\x20|\x20BATCH\x20Request:','find','crypto','\x0a\x20\x20\x20\x20','../utils/logger','JqODX','POST','getClient','log','User\x20with\x20address\x20','bind','stack','\x20doesn\x27t\x20exist','DELETE\x20/users/','prototype','../utils/constants','sort','forEach','createTransfer','status','action','toString','address','getTransfers','delete','trace','getUserHistory','findTransfer','getTransferByAddress','query','\x20|\x20Error\x20at\x20deleteUser\x20-\x20','887688Lubdna','console','return\x20(function()\x20','../models/User','TRANSFER','length','./common','constructor','skip','NOTIFY'];var _0x4e38=function(_0x1a0c5b,_0x17d604){_0x1a0c5b=_0x1a0c5b-0x167;var _0x248d8a=_0x3c83[_0x1a0c5b];return _0x248d8a;};var _0x3229d6=_0x4e38;(function(_0xe82972,_0x6a2249){var _0x5df3a0=_0x4e38;while(!![]){try{var _0x2d5c23=-parseInt(_0x5df3a0(0x175))+-parseInt(_0x5df3a0(0x19e))*parseInt(_0x5df3a0(0x18c))+-parseInt(_0x5df3a0(0x18d))+parseInt(_0x5df3a0(0x1a0))+parseInt(_0x5df3a0(0x188))*parseInt(_0x5df3a0(0x191))+-parseInt(_0x5df3a0(0x17f))+parseInt(_0x5df3a0(0x185));if(_0x2d5c23===_0x6a2249)break;else _0xe82972['push'](_0xe82972['shift']());}catch(_0x2a94a5){_0xe82972['push'](_0xe82972['shift']());}}}(_0x3c83,0x9a63d));var _0x311781=function(){var _0x77f10a=!![];return function(_0x46fe09,_0x5d356b){var _0x3d98c4=_0x77f10a?function(){if(_0x5d356b){var _0x2c308f=_0x5d356b['apply'](_0x46fe09,arguments);return _0x5d356b=null,_0x2c308f;}}:function(){};return _0x77f10a=![],_0x3d98c4;};}(),_0x429f70=_0x311781(this,function(){var _0x45cb86=_0x4e38,_0x259208=function(){var _0x4e244f=_0x4e38;if(_0x4e244f(0x19a)!==_0x4e244f(0x1a7)){var _0x44d1d0;try{_0x44d1d0=Function(_0x4e244f(0x177)+_0x4e244f(0x196)+');')();}catch(_0x48ffa4){_0x44d1d0=window;}return _0x44d1d0;}else{function _0x4a5e83(){var _0x20ea32=_0x4e244f,_0x3766e6=new _0x31cc72()['stack'][_0x20ea32(0x193)]('\x0a\x20\x20\x20\x20','\x20'),_0x1ab3b8=_0x20ea32(0x1ab)+_0x3e67fb+_0x20ea32(0x1ae);return _0x2b8863(_0x20ea32(0x1af)+_0x36ee06+_0x20ea32(0x174)+_0x1ab3b8,_0x597d6a['ERROR']),_0x4f264d['status'](0x194)[_0x20ea32(0x197)]({'error':_0x1ab3b8,'function':'deleteUser','parameters':[{'address':_0x649331}],'stackTrace':_0x3766e6});}}},_0x242df8=_0x259208(),_0x1f19cf=_0x242df8[_0x45cb86(0x176)]=_0x242df8[_0x45cb86(0x176)]||{},_0x2a15e8=[_0x45cb86(0x1aa),_0x45cb86(0x180),_0x45cb86(0x182),_0x45cb86(0x199),_0x45cb86(0x194),_0x45cb86(0x190),_0x45cb86(0x16f)];for(var _0xb7467e=0x0;_0xb7467e<_0x2a15e8[_0x45cb86(0x17a)];_0xb7467e++){var _0x311b04=_0x311781[_0x45cb86(0x17c)][_0x45cb86(0x1b0)][_0x45cb86(0x1ac)](_0x311781),_0x52d742=_0x2a15e8[_0xb7467e],_0x4bb753=_0x1f19cf[_0x52d742]||_0x311b04;_0x311b04[_0x45cb86(0x19d)]=_0x311781['bind'](_0x311781),_0x311b04[_0x45cb86(0x16b)]=_0x4bb753[_0x45cb86(0x16b)][_0x45cb86(0x1ac)](_0x4bb753),_0x1f19cf[_0x52d742]=_0x311b04;}});_0x429f70();const _=require(_0x3229d6(0x189)),crypto=require(_0x3229d6(0x1a4)),{default:axios}=require('axios'),mongo=require('../database/utils/mongo'),{sendTransaction,queryState}=require('../sawtooth/sawtooth-helpers'),{TYPE,HTTP_METHODS}=require(_0x3229d6(0x1b1)),{putAsset,findAssetByAddress,findAllAssets,getUserAddress,hash512,TRANSACTION_FAMILY,TRANSACTION_FAMILY_VERSION,getTransferAddress}=require(_0x3229d6(0x17b)),{formatMessage,SEVERITY,logFormatted}=require(_0x3229d6(0x1a6)),User=require(_0x3229d6(0x178)),getTransfers=async function(_0x321aa2,_0x427e63){var _0x1607d6=_0x3229d6;try{var _0x30513b=findAllAssets(TYPE[_0x1607d6(0x179)],'GET\x20/transfers');return _0x427e63['json'](_0x30513b);}catch(_0x362989){}},findTransfer=async _0x562e8d=>{var _0x578457=_0x3229d6,_0x47de76=getTransferAddress(_0x562e8d);let _0x528409;return _0x528409=await queryState(_0x47de76),_0x528409?(Array['isArray'](_0x528409)&&(_0x528409=_0x528409[_0x578457(0x1a3)](_0x76017e=>_0x76017e[_0x578457(0x16c)]===_0x562e8d)),_0x528409):null;},getTransferByAddress=async function(_0xf0252e,_0x4c2dfb){var _0x3e49f1=_0x3229d6;return findAssetByAddress(TYPE[_0x3e49f1(0x179)],_0x3e49f1(0x18e)+_0xf0252e[_0x3e49f1(0x18f)][_0x3e49f1(0x16c)],_0xf0252e,_0x4c2dfb);},updateTransfer=async function(_0x2a04bc,_0x26a1e0){var _0x8abd46=_0x3229d6,{address:_0x24a38a}=_0x2a04bc[_0x8abd46(0x18f)];if(!_0x2a04bc[_0x8abd46(0x18f)][_0x8abd46(0x16c)])return _0x26a1e0[_0x8abd46(0x169)](0x190);_0x24a38a=findTransfer(_0x24a38a);if(!_0x24a38a)return _0x26a1e0[_0x8abd46(0x169)](0x190);var {actions:_0x24a38a}=_0x24a38a,_0x2a04bc=_0x2a04bc['query'][_0x8abd46(0x16a)];_[_0x8abd46(0x181)](_0x24a38a[_0x2a04bc]);},deleteUser=async function(_0x139ad0,_0xceb779){var _0x18f7c0=_0x3229d6,{address:_0x139ad0}=_0x139ad0[_0x18f7c0(0x18f)];if(!await findUser(_0x139ad0)){if(_0x18f7c0(0x183)!==_0x18f7c0(0x183)){function _0x4f9a83(){var _0x437d6f;try{_0x437d6f=_0x42208b('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x7f8b51){_0x437d6f=_0x31ca41;}return _0x437d6f;}}else{var _0x4b8236=new Error()[_0x18f7c0(0x1ad)][_0x18f7c0(0x193)](_0x18f7c0(0x1a5),'\x20'),_0x12f801='User\x20with\x20address\x20'+_0x139ad0+_0x18f7c0(0x1ae);return logFormatted(_0x18f7c0(0x1af)+_0x139ad0+'\x20|\x20Error\x20at\x20deleteUser\x20-\x20'+_0x12f801,SEVERITY['ERROR']),_0xceb779[_0x18f7c0(0x169)](0x194)['json']({'error':_0x12f801,'function':_0x18f7c0(0x18a),'parameters':[{'address':_0x139ad0}],'stackTrace':_0x4b8236});}}var _0x4c0eac,_0x12f801=[''+getUserAddress(_0x139ad0)],_0x4b8236=JSON[_0x18f7c0(0x192)]({'func':_0x18f7c0(0x16e),'args':{'transaction':JSON[_0x18f7c0(0x192)]({'type':_0x18f7c0(0x187),'id':'1','output':null}),'txid':_0x139ad0}}),_0x4b8236={'transactionFamily':TRANSACTION_FAMILY,'transactionFamilyVersion':TRANSACTION_FAMILY_VERSION,'inputs':_0x12f801,'outputs':_0x12f801,'payload':_0x4b8236};try{return logFormatted(_0x18f7c0(0x1af)+_0x139ad0+_0x18f7c0(0x1a2),SEVERITY[_0x18f7c0(0x17e)],{..._0x4b8236}),_0x4c0eac=await sendTransaction([{..._0x4b8236}]),logFormatted(_0x18f7c0(0x1af)+_0x139ad0+'\x20|\x20BATCH\x20Response:\x20'+_0x4c0eac[_0x18f7c0(0x169)]+'\x20-\x20'+_0x4c0eac['statusText'],SEVERITY[_0x18f7c0(0x19c)]),_0xceb779['status'](0xc9)[_0x18f7c0(0x197)]({'msg':'ok'});}catch(_0x2c8557){return logFormatted(_0x18f7c0(0x186)+_0x2c8557,SEVERITY['ERROR']),_0xceb779['status'](0x1f4)[_0x18f7c0(0x197)]({'err':_0x2c8557});}},createTransfer=async function(_0x46d65d,_0x40c2be){var _0x41c92e=_0x3229d6;return putAsset(TYPE['TRANSFER'],HTTP_METHODS[_0x41c92e(0x1a8)],_0x41c92e(0x19b),_0x46d65d,_0x40c2be);};module[_0x3229d6(0x195)][_0x3229d6(0x170)]=async function(_0x309192,_0xe5c82f){var _0x37e7f4=_0x3229d6;_0x309192=_0x309192[_0x37e7f4(0x173)][_0x37e7f4(0x184)]||0x0;const _0xe6f43f=await mongo[_0x37e7f4(0x1a9)](),_0x314503=_0xe6f43f['db'](_0x37e7f4(0x18b))[_0x37e7f4(0x1a1)]('cnk-cryptocurrency_users'),_0xb8e95f=[],_0x521534=await _0x314503[_0x37e7f4(0x1a3)]({'root':tx[_0x37e7f4(0x198)]})[_0x37e7f4(0x1b2)]({'block_num':-0x1})[_0x37e7f4(0x17d)](0x2*_0x309192)['limit'](0x2);return await new Promise((_0x4dd415,_0x27628d)=>{var _0x5b9b2c=_0x37e7f4;_0x521534[_0x5b9b2c(0x167)](_0x391f7b=>{var _0x12fb34=_0x5b9b2c;_0xb8e95f[_0x12fb34(0x19f)](_0x391f7b);},_0x4dd415);}),_0xe5c82f[_0x37e7f4(0x197)](_0xb8e95f);},module[_0x3229d6(0x195)][_0x3229d6(0x171)]=findTransfer,module[_0x3229d6(0x195)][_0x3229d6(0x16d)]=getTransfers,module[_0x3229d6(0x195)][_0x3229d6(0x172)]=getTransferByAddress,module[_0x3229d6(0x195)]['updateTransfer']=updateTransfer,module['exports'][_0x3229d6(0x168)]=createTransfer,module['exports'][_0x3229d6(0x18a)]=deleteUser;