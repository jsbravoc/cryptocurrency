var _0x3e7b=['exports','collection','TRANSFER','../database/utils/mongo','crypto','\x20|\x20BATCH\x20Response:\x20','info','1kKePeB','243227eoVdwY','POST','bind','findTransfer','axios','isArray','console','GET\x20/transfers','push','find','\x0a\x20\x20\x20\x20','length','527287DAawJX','constructor','{}.constructor(\x22return\x20this\x22)(\x20)','fWXLI','SUCCESS','page','statusText','warn','\x20-\x20','../utils/logger','cnk-cryptocurrency_users','params','createTransfer','DELETE\x20/users\x20|\x20BATCH\x20Response:\x20','status','\x20|\x20Error\x20at\x20deleteUser\x20-\x20','replace','EbGsf','ERROR','stringify','Pigwx','delete','246131keqfBA','721166EAgurX','apply','VJqcI','mydb','743wmkGSF','updateTransfer','GET\x20/transfer/','DELETE\x20/users/','stack','ZVxdT','return\x20(function()\x20','address','limit','123dCPDML','error','717089mnujKN','toString','User\x20with\x20address\x20','../sawtooth/sawtooth-helpers','../models/User','210792eNrlYM','deleteUser','njMOr','json','NoLLI','2oIoiTo','query','\x20doesn\x27t\x20exist','forEach','trace','sdzJI','log','isEmpty','skip','prototype','sort'];var _0x4ac0=function(_0x2c3e55,_0x3d93fa){_0x2c3e55=_0x2c3e55-0x1e2;var _0x154a73=_0x3e7b[_0x2c3e55];return _0x154a73;};var _0x1c8e45=_0x4ac0;(function(_0xea804d,_0x147e33){var _0x3836da=_0x4ac0;while(!![]){try{var _0xa4f3dc=parseInt(_0x3836da(0x201))*-parseInt(_0x3836da(0x21d))+parseInt(_0x3836da(0x1f2))+-parseInt(_0x3836da(0x206))+-parseInt(_0x3836da(0x1f1))+-parseInt(_0x3836da(0x1ff))*parseInt(_0x3836da(0x1f6))+parseInt(_0x3836da(0x20b))*parseInt(_0x3836da(0x21e))+parseInt(_0x3836da(0x22a));if(_0xa4f3dc===_0x147e33)break;else _0xea804d['push'](_0xea804d['shift']());}catch(_0x3d2dab){_0xea804d['push'](_0xea804d['shift']());}}}(_0x3e7b,0x72a02));var _0x128339=function(){var _0x424ee5=!![];return function(_0x24f131,_0x117bb3){var _0x219f57=_0x4ac0;if(_0x219f57(0x1f4)!==_0x219f57(0x1ec)){var _0x46ad84=_0x424ee5?function(){var _0x22dab1=_0x219f57;if(_0x117bb3){var _0x2c1b6a=_0x117bb3[_0x22dab1(0x1f3)](_0x24f131,arguments);return _0x117bb3=null,_0x2c1b6a;}}:function(){};return _0x424ee5=![],_0x46ad84;}else{function _0x5ee2cb(){var _0x36eb4e=_0x219f57;_0x363332=_0x59d127('return\x20(function()\x20'+_0x36eb4e(0x22c)+');')();}}};}(),_0x5b5621=_0x128339(this,function(){var _0x4d921b=_0x4ac0,_0x93a60d=function(){var _0x532e41=_0x4ac0;if(_0x532e41(0x208)!=='gjSiC'){var _0xf1c5c9;try{if(_0x532e41(0x22d)!==_0x532e41(0x22d)){function _0xd555f2(){var _0x1ffb4a=_0x532e41;if(_0x10b07c){var _0xd8ec09=_0x374333[_0x1ffb4a(0x1f3)](_0x3f65a8,arguments);return _0x282d70=null,_0xd8ec09;}}}else _0xf1c5c9=Function(_0x532e41(0x1fc)+_0x532e41(0x22c)+');')();}catch(_0x425eaa){_0xf1c5c9=window;}return _0xf1c5c9;}else{function _0x580a7a(){var _0x555376=_0x532e41,_0xa6d56e=_0x45ed46[_0x555376(0x22b)][_0x555376(0x214)][_0x555376(0x220)](_0x4ffd94),_0x2948eb=_0x28efdb[_0x5f25d4],_0x105a98=_0x1ab31e[_0x2948eb]||_0xa6d56e;_0xa6d56e['__proto__']=_0x38ca52[_0x555376(0x220)](_0x517c4a),_0xa6d56e['toString']=_0x105a98[_0x555376(0x202)][_0x555376(0x220)](_0x105a98),_0x1e7b48[_0x2948eb]=_0xa6d56e;}}},_0x40c26c=_0x93a60d(),_0x531a27=_0x40c26c[_0x4d921b(0x224)]=_0x40c26c['console']||{},_0x23437e=[_0x4d921b(0x211),_0x4d921b(0x1e2),_0x4d921b(0x21c),_0x4d921b(0x200),'exception','table',_0x4d921b(0x20f)];for(var _0x5c0983=0x0;_0x5c0983<_0x23437e[_0x4d921b(0x229)];_0x5c0983++){var _0x15ba0a=_0x128339[_0x4d921b(0x22b)]['prototype'][_0x4d921b(0x220)](_0x128339),_0x35b137=_0x23437e[_0x5c0983],_0x283fcc=_0x531a27[_0x35b137]||_0x15ba0a;_0x15ba0a['__proto__']=_0x128339['bind'](_0x128339),_0x15ba0a[_0x4d921b(0x202)]=_0x283fcc[_0x4d921b(0x202)][_0x4d921b(0x220)](_0x283fcc),_0x531a27[_0x35b137]=_0x15ba0a;}});_0x5b5621();const _=require('underscore'),crypto=require(_0x1c8e45(0x21a)),{default:axios}=require(_0x1c8e45(0x222)),mongo=require(_0x1c8e45(0x219)),{sendTransaction,queryState}=require(_0x1c8e45(0x204)),{TYPE,HTTP_METHODS}=require('../utils/constants'),{putAsset,findAssetByAddress,findAllAssets,getUserAddress,hash512,TRANSACTION_FAMILY,TRANSACTION_FAMILY_VERSION,getTransferAddress}=require('./common'),{formatMessage,SEVERITY,logFormatted}=require(_0x1c8e45(0x1e4)),User=require(_0x1c8e45(0x205)),getTransfers=async function(_0x36f2a4,_0x1cfd1f){var _0x2aa48e=_0x1c8e45;try{var _0x12080e=findAllAssets(TYPE[_0x2aa48e(0x218)],_0x2aa48e(0x225));return _0x1cfd1f['json'](_0x12080e);}catch(_0x1ba467){}},findTransfer=async _0x2b2fa2=>{var _0x1772e1=_0x1c8e45,_0x66a00b=getTransferAddress(_0x2b2fa2);let _0x1a52cc;return _0x1a52cc=await queryState(_0x66a00b),_0x1a52cc?(Array[_0x1772e1(0x223)](_0x1a52cc)&&(_0x1a52cc=_0x1a52cc[_0x1772e1(0x227)](_0x59a4ae=>_0x59a4ae[_0x1772e1(0x1fd)]===_0x2b2fa2)),_0x1a52cc):null;},getTransferByAddress=async function(_0x1e6816,_0x22dd66){var _0x22bbe9=_0x1c8e45;return findAssetByAddress(TYPE[_0x22bbe9(0x218)],_0x22bbe9(0x1f8)+_0x1e6816[_0x22bbe9(0x1e6)][_0x22bbe9(0x1fd)],_0x1e6816,_0x22dd66);},updateTransfer=async function(_0x15a502,_0x31c243){var _0x51774e=_0x1c8e45,{address:_0x4f3881}=_0x15a502[_0x51774e(0x1e6)];if(!_0x15a502[_0x51774e(0x1e6)][_0x51774e(0x1fd)])return _0x31c243['status'](0x190);_0x4f3881=findTransfer(_0x4f3881);if(!_0x4f3881)return _0x31c243['status'](0x190);var {actions:_0x4f3881}=_0x4f3881,_0x15a502=_0x15a502['query']['action'];_[_0x51774e(0x212)](_0x4f3881[_0x15a502]);},deleteUser=async function(_0x69575e,_0x140f74){var _0x4b7e73=_0x1c8e45,{address:_0x69575e}=_0x69575e[_0x4b7e73(0x1e6)];if(!await findUser(_0x69575e)){if('Pigwx'!==_0x4b7e73(0x1ef)){function _0x3cddfb(){_0x637726=_0xacb582;}}else{var _0x352649=new Error()[_0x4b7e73(0x1fa)][_0x4b7e73(0x1eb)](_0x4b7e73(0x228),'\x20'),_0xf73129=_0x4b7e73(0x203)+_0x69575e+_0x4b7e73(0x20d);return logFormatted(_0x4b7e73(0x1f9)+_0x69575e+_0x4b7e73(0x1ea)+_0xf73129,SEVERITY['ERROR']),_0x140f74[_0x4b7e73(0x1e9)](0x194)[_0x4b7e73(0x209)]({'error':_0xf73129,'function':_0x4b7e73(0x207),'parameters':[{'address':_0x69575e}],'stackTrace':_0x352649});}}var _0x3885a3,_0xf73129=[''+getUserAddress(_0x69575e)],_0x352649=JSON[_0x4b7e73(0x1ee)]({'func':_0x4b7e73(0x1f0),'args':{'transaction':JSON[_0x4b7e73(0x1ee)]({'type':'user','id':'1','output':null}),'txid':_0x69575e}}),_0x352649={'transactionFamily':TRANSACTION_FAMILY,'transactionFamilyVersion':TRANSACTION_FAMILY_VERSION,'inputs':_0xf73129,'outputs':_0xf73129,'payload':_0x352649};try{if(_0x4b7e73(0x210)===_0x4b7e73(0x210))return logFormatted(_0x4b7e73(0x1f9)+_0x69575e+'\x20|\x20BATCH\x20Request:',SEVERITY['NOTIFY'],{..._0x352649}),_0x3885a3=await sendTransaction([{..._0x352649}]),logFormatted('DELETE\x20/users/'+_0x69575e+_0x4b7e73(0x21b)+_0x3885a3[_0x4b7e73(0x1e9)]+_0x4b7e73(0x1e3)+_0x3885a3[_0x4b7e73(0x230)],SEVERITY[_0x4b7e73(0x22e)]),_0x140f74['status'](0xc9)[_0x4b7e73(0x209)]({'msg':'ok'});else{function _0x4dd8e4(){var _0x426ecf=_0x4b7e73;try{var _0x2c4c68=_0x127d23(_0x3b913d['TRANSFER'],'GET\x20/transfers');return _0x41ec57[_0x426ecf(0x209)](_0x2c4c68);}catch(_0x58feae){}}}}catch(_0x4772d7){return logFormatted(_0x4b7e73(0x1e8)+_0x4772d7,SEVERITY['ERROR']),_0x140f74[_0x4b7e73(0x1e9)](0x1f4)[_0x4b7e73(0x209)]({'err':_0x4772d7});}},createTransfer=async function(_0x459348,_0x345e35){var _0xb6dd5c=_0x1c8e45;return putAsset(TYPE[_0xb6dd5c(0x218)],HTTP_METHODS[_0xb6dd5c(0x21f)],'POST\x20/transfers',_0x459348,_0x345e35);};module[_0x1c8e45(0x216)]['getUserHistory']=async function(_0x5a676c,_0x89d174){var _0x16361e=_0x1c8e45;_0x5a676c=_0x5a676c[_0x16361e(0x20c)][_0x16361e(0x22f)]||0x0;const _0x247b3d=await mongo['getClient'](),_0x398345=_0x247b3d['db'](_0x16361e(0x1f5))[_0x16361e(0x217)](_0x16361e(0x1e5)),_0x4f6fff=[],_0x4cd7d1=await _0x398345[_0x16361e(0x227)]({'root':tx['root']})[_0x16361e(0x215)]({'block_num':-0x1})[_0x16361e(0x213)](0x2*_0x5a676c)[_0x16361e(0x1fe)](0x2);return await new Promise((_0x4e0f78,_0xe191e0)=>{var _0x4f323c=_0x16361e;_0x4cd7d1[_0x4f323c(0x20e)](_0x1b26bf=>{var _0xae8bf5=_0x4f323c;if(_0xae8bf5(0x1fb)!==_0xae8bf5(0x20a))_0x4f6fff[_0xae8bf5(0x226)](_0x1b26bf);else{function _0x14a232(){var _0x530324=_0xae8bf5,_0x5345c6=new _0x4d485c()[_0x530324(0x1fa)][_0x530324(0x1eb)]('\x0a\x20\x20\x20\x20','\x20'),_0x4423dd='User\x20with\x20address\x20'+_0x39ff23+_0x530324(0x20d);return _0x1448d7(_0x530324(0x1f9)+_0x5b72c4+'\x20|\x20Error\x20at\x20deleteUser\x20-\x20'+_0x4423dd,_0x44023f[_0x530324(0x1ed)]),_0x2475c2[_0x530324(0x1e9)](0x194)[_0x530324(0x209)]({'error':_0x4423dd,'function':_0x530324(0x207),'parameters':[{'address':_0x12484b}],'stackTrace':_0x5345c6});}}},_0x4e0f78);}),_0x89d174[_0x16361e(0x209)](_0x4f6fff);},module[_0x1c8e45(0x216)][_0x1c8e45(0x221)]=findTransfer,module['exports']['getTransfers']=getTransfers,module[_0x1c8e45(0x216)]['getTransferByAddress']=getTransferByAddress,module[_0x1c8e45(0x216)][_0x1c8e45(0x1f7)]=updateTransfer,module[_0x1c8e45(0x216)][_0x1c8e45(0x1e7)]=createTransfer,module[_0x1c8e45(0x216)][_0x1c8e45(0x207)]=deleteUser;