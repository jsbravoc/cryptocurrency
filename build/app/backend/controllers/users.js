const _0x2f80=['ZcFLg','2XkuEpx','getUserHistory','stringify','303733ANwMCA','VeqAV','signature','exception','3174dWfsuJ','cnk-cryptocurrency_users','exports','ZpmmC','SnqZX','replace','true','bind','return\x20(function()\x20','updateUser','OkqzN','__proto__','limit','20833aRkqfl','apply','DELETE\x20/users/','\x20|\x20Error\x20at\x20deleteUser\x20-\x20','hlHnT','DELETE\x20/users\x20|\x20BATCH\x20Response:\x20','9713IAPLwK','find','stack','\x0a\x20\x20\x20\x20','47jlEDZI','ITGEZ','isNaN','\x20doesn\x27t\x20exist','params','iYYBc','deleteUser','1PtDNcM','getUserByAddress','trace','649370UUcIQE','push','axios','warn','prototype','query','length','\x20|\x20BATCH\x20Request:','console','toString','lastest_transactions','json','../utils/constants','getUsers','user','page','underscore','USER','address','IJXjp','425314UOzaTY','ERROR','log','POST\x20/users','forEach','constructor','ZLTeL','mydb','expanded','status','pending_transactions','./cryptocurrency','1122175HSCbeZ','PUT\x20/users','../utils/logger','findUser','13MTSvGi','PUT','delete','User\x20with\x20address\x20','../sawtooth/sawtooth-helpers','DLpWn'];const _0x2877=function(_0x36da24,_0x39a2a3){_0x36da24=_0x36da24-0xe0;let _0x300960=_0x2f80[_0x36da24];return _0x300960;};const _0x3f99e4=_0x2877;(function(_0x123e78,_0x594c91){const _0x463d9d=_0x2877;while(!![]){try{const _0x341942=parseInt(_0x463d9d(0x10d))+-parseInt(_0x463d9d(0x132))+-parseInt(_0x463d9d(0x12f))*-parseInt(_0x463d9d(0xff))+parseInt(_0x463d9d(0x10a))*parseInt(_0x463d9d(0xf3))+parseInt(_0x463d9d(0x11e))*-parseInt(_0x463d9d(0x128))+parseInt(_0x463d9d(0x111))*parseInt(_0x463d9d(0x103))+-parseInt(_0x463d9d(0x124));if(_0x341942===_0x594c91)break;else _0x123e78['push'](_0x123e78['shift']());}catch(_0x36926d){_0x123e78['push'](_0x123e78['shift']());}}}(_0x2f80,0xa5e8c));const _0x303a16=function(){let _0x7ddc32=!![];return function(_0x3ce7e5,_0x1c4b7b){const _0x3505f3=_0x2877;if(_0x3505f3(0x10e)!==_0x3505f3(0x11b)){const _0x3a201f=_0x7ddc32?function(){const _0x32a4b1=_0x3505f3;if(_0x1c4b7b){if('IJXjp'!==_0x32a4b1(0xf2)){function _0x45539b(){_0x52c7a8=_0x2b9317;}}else{const _0x41c69c=_0x1c4b7b[_0x32a4b1(0x11f)](_0x3ce7e5,arguments);return _0x1c4b7b=null,_0x41c69c;}}}:function(){};return _0x7ddc32=![],_0x3a201f;}else{function _0x470e88(){const _0x3539d3=_0x3505f3,_0x1bc66e=_0x51c639[_0x3539d3(0x11f)](_0x58b258,arguments);return _0x3df7be=null,_0x1bc66e;}}};}(),_0x2054d0=_0x303a16(this,function(){const _0x3c03fe=_0x2877;let _0x325132;try{if('KEqOJ'!==_0x3c03fe(0x114)){const _0x329908=Function(_0x3c03fe(0x119)+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x325132=_0x329908();}else{function _0x2e8c2d(){const _0x410e84=_0x3968b0?function(){if(_0x18da51){const _0x20e1c3=_0x71f889['apply'](_0x4eff51,arguments);return _0x2df22c=null,_0x20e1c3;}}:function(){};return _0x4919e1=![],_0x410e84;}}}catch(_0x4cf4c0){_0x325132=window;}const _0x235e7e=_0x325132['console']=_0x325132[_0x3c03fe(0xe7)]||{},_0x2d5c4c=[_0x3c03fe(0xf5),_0x3c03fe(0xe2),'info','error',_0x3c03fe(0x110),'table',_0x3c03fe(0x131)];for(let _0x53d676=0x0;_0x53d676<_0x2d5c4c[_0x3c03fe(0xe5)];_0x53d676++){if(_0x3c03fe(0x115)===_0x3c03fe(0x115)){const _0x472543=_0x303a16['constructor']['prototype'][_0x3c03fe(0x118)](_0x303a16),_0x45fc33=_0x2d5c4c[_0x53d676],_0x3131b7=_0x235e7e[_0x45fc33]||_0x472543;_0x472543['__proto__']=_0x303a16[_0x3c03fe(0x118)](_0x303a16),_0x472543[_0x3c03fe(0xe8)]=_0x3131b7[_0x3c03fe(0xe8)][_0x3c03fe(0x118)](_0x3131b7),_0x235e7e[_0x45fc33]=_0x472543;}else{function _0x351e22(){const _0x373a0e=_0x3c03fe;_0x30258f[_0x373a0e(0xf7)](_0x39d1ac=>{_0x32e79d['push'](_0x39d1ac);},_0x1d5560);}}}});_0x2054d0();const _=require(_0x3f99e4(0xef)),crypto=require('crypto'),{default:axios}=require(_0x3f99e4(0xe1)),mongo=require('../database/utils/mongo'),{sendTransaction,queryState}=require(_0x3f99e4(0x107)),{TYPE,HTTP_METHODS}=require(_0x3f99e4(0xeb)),{putAsset,findAssetByAddress,findAllAssets,getUserAddress,hash512,TRANSACTION_FAMILY,TRANSACTION_FAMILY_VERSION}=require('./common'),{findTransaction,expandSupportingTransactions}=require(_0x3f99e4(0xfe)),{formatMessage,SEVERITY,logFormatted}=require(_0x3f99e4(0x101)),User=require('../models/User'),getUsers=async function(_0x5b3ddb,_0x332a9d){const _0x40bab8=_0x3f99e4;let _0x2b53e4,_0x1a82be;var _0x2db439=_0x40bab8(0x117)===_0x5b3ddb[_0x40bab8(0xe4)][_0x40bab8(0xfb)]||!0x1,_0x5b3ddb=Number[_0x40bab8(0x12a)](Number(_0x5b3ddb[_0x40bab8(0xe4)]['limit']))?0x0:Number(_0x5b3ddb[_0x40bab8(0xe4)][_0x40bab8(0x11d)]);try{_0x2b53e4=await findAllAssets(TYPE[_0x40bab8(0xf0)],'GET\x20/users',_0x5b3ddb)||[],_0x1a82be=await findAllAssets(TYPE['TRANSACTION'],'GET\x20/users',_0x5b3ddb)||[];}catch(_0x576bbe){return _0x332a9d['status'](0x1f7)[_0x40bab8(0xea)]({'msg':'Sawtooth\x20service\x20unavailable'});}if(!_0x2db439)return _0x332a9d[_0x40bab8(0xea)](_0x2b53e4);const _0x343b9a={};_0x1a82be[_0x40bab8(0xf7)](_0x5850e7=>{const _0x2bdde9=_0x40bab8;if(_0x2bdde9(0x122)!==_0x2bdde9(0x12d))_0x343b9a[_0x5850e7[_0x2bdde9(0x10f)]]=_0x5850e7;else{function _0x31fe38(){const _0x4d5aab=_0x2bdde9;var _0x45b8d7=new _0x5cb5f1()['stack'][_0x4d5aab(0x116)](_0x4d5aab(0x127),'\x20'),_0x1bb6d7=_0x4d5aab(0x106)+_0x479b19+_0x4d5aab(0x12b);return _0x173725(_0x4d5aab(0x120)+_0x314f18+_0x4d5aab(0x121)+_0x1bb6d7,_0x353c62[_0x4d5aab(0xf4)]),_0x58729d['status'](0x194)[_0x4d5aab(0xea)]({'error':_0x1bb6d7,'function':_0x4d5aab(0x12e),'parameters':[{'address':_0x1fa6cc}],'stackTrace':_0x45b8d7});}}});for(let _0x19ab46=0x0;_0x19ab46<_0x2b53e4['length'];_0x19ab46+=0x1){for(let _0x468875=0x0;_0x468875<(_0x2b53e4[_0x19ab46][_0x40bab8(0xe9)]||[])['length'];_0x468875+=0x1)_0x2b53e4[_0x19ab46][_0x40bab8(0xe9)][_0x468875]=await findTransaction(_0x2b53e4[_0x19ab46][_0x40bab8(0xe9)][_0x468875]),await expandSupportingTransactions(_0x2b53e4[_0x19ab46][_0x40bab8(0xe9)][_0x468875],_0x343b9a);for(let _0x56ac1e=0x0;_0x56ac1e<(_0x2b53e4[_0x19ab46]['pending_transactions']||[])[_0x40bab8(0xe5)];_0x56ac1e+=0x1)_0x2b53e4[_0x19ab46][_0x40bab8(0xfd)][_0x56ac1e]=await findTransaction(_0x2b53e4[_0x19ab46][_0x40bab8(0xfd)][_0x56ac1e]),await expandSupportingTransactions(_0x2b53e4[_0x19ab46][_0x40bab8(0xfd)][_0x56ac1e],_0x343b9a);}return _0x332a9d[_0x40bab8(0xfc)](0xc8)[_0x40bab8(0xea)](_0x2b53e4);},findUser=async _0x55898c=>{const _0x2f3d87=_0x3f99e4;var _0x12937d=getUserAddress(_0x55898c);let _0x6c8c93;return _0x6c8c93=await queryState(_0x12937d),_0x6c8c93?(Array['isArray'](_0x6c8c93)&&(_0x6c8c93=_0x6c8c93['find'](_0x170015=>_0x170015[_0x2f3d87(0xf1)]===_0x55898c)),_0x6c8c93):null;},getUserByAddress=async function(_0x330f9e,_0x2ca9b4){const _0x7d4912=_0x3f99e4;return findAssetByAddress(TYPE['USER'],'GET\x20/user/'+_0x330f9e[_0x7d4912(0x12c)][_0x7d4912(0xf1)],_0x330f9e,_0x2ca9b4);},updateUser=async function(_0x318ad2,_0x1f9f10){const _0x4230ee=_0x3f99e4;return putAsset(TYPE[_0x4230ee(0xf0)],HTTP_METHODS[_0x4230ee(0x104)],_0x4230ee(0x100),_0x318ad2,_0x1f9f10);},deleteUser=async function(_0x414247,_0xd6326a){const _0x415c34=_0x3f99e4;var {address:_0x414247}=_0x414247['params'];if(!await findUser(_0x414247)){if(_0x415c34(0x129)==='ITGEZ'){var _0x40ef47=new Error()[_0x415c34(0x126)][_0x415c34(0x116)]('\x0a\x20\x20\x20\x20','\x20'),_0x4b4480=_0x415c34(0x106)+_0x414247+_0x415c34(0x12b);return logFormatted(_0x415c34(0x120)+_0x414247+'\x20|\x20Error\x20at\x20deleteUser\x20-\x20'+_0x4b4480,SEVERITY[_0x415c34(0xf4)]),_0xd6326a[_0x415c34(0xfc)](0x194)['json']({'error':_0x4b4480,'function':_0x415c34(0x12e),'parameters':[{'address':_0x414247}],'stackTrace':_0x40ef47});}else{function _0x3270a1(){const _0x21e1f1=_0x415c34,_0x1d6052=_0x486e8a[_0x21e1f1(0xf8)][_0x21e1f1(0xe3)]['bind'](_0x216f11),_0xff2592=_0x27a0ec[_0x25f19a],_0x25c1ee=_0x30334c[_0xff2592]||_0x1d6052;_0x1d6052[_0x21e1f1(0x11c)]=_0x362ed3['bind'](_0x268b77),_0x1d6052[_0x21e1f1(0xe8)]=_0x25c1ee['toString'][_0x21e1f1(0x118)](_0x25c1ee),_0x18d0d7[_0xff2592]=_0x1d6052;}}}var _0x588a09,_0x4b4480=[''+getUserAddress(_0x414247)],_0x40ef47=JSON[_0x415c34(0x10c)]({'func':_0x415c34(0x105),'args':{'transaction':JSON[_0x415c34(0x10c)]({'type':_0x415c34(0xed),'id':'1','output':null}),'txid':_0x414247}}),_0x40ef47={'transactionFamily':TRANSACTION_FAMILY,'transactionFamilyVersion':TRANSACTION_FAMILY_VERSION,'inputs':_0x4b4480,'outputs':_0x4b4480,'payload':_0x40ef47};try{if('zGYsJ'!==_0x415c34(0xf9))return logFormatted(_0x415c34(0x120)+_0x414247+_0x415c34(0xe6),SEVERITY['NOTIFY'],{..._0x40ef47}),_0x588a09=await sendTransaction([{..._0x40ef47}]),logFormatted('DELETE\x20/users/'+_0x414247+'\x20|\x20BATCH\x20Response:\x20'+_0x588a09[_0x415c34(0xfc)]+'\x20-\x20'+_0x588a09['statusText'],SEVERITY['SUCCESS']),_0xd6326a['status'](0xc9)[_0x415c34(0xea)]({'msg':'ok'});else{function _0x44d114(){const _0x5d5c58=_0x415c34;return _0x510f26(_0x38ff38[_0x5d5c58(0xf0)],_0x3660cf['PUT'],_0x5d5c58(0x100),_0x3875ab,_0x3ea63b);}}}catch(_0x5ef120){return logFormatted(_0x415c34(0x123)+_0x5ef120,SEVERITY[_0x415c34(0xf4)]),_0xd6326a['status'](0x1f4)[_0x415c34(0xea)]({'err':_0x5ef120});}},createUser=async function(_0x97e0ec,_0x3ae576){const _0x49111a=_0x3f99e4;return putAsset(TYPE['USER'],HTTP_METHODS['POST'],_0x49111a(0xf6),_0x97e0ec,_0x3ae576);};module[_0x3f99e4(0x113)][_0x3f99e4(0x10b)]=async function(_0x425802,_0x50b4f7){const _0x55ba1c=_0x3f99e4;_0x425802=_0x425802[_0x55ba1c(0xe4)][_0x55ba1c(0xee)]||0x0;const _0x1834f8=await mongo['getClient'](),_0x350eca=_0x1834f8['db'](_0x55ba1c(0xfa))['collection'](_0x55ba1c(0x112)),_0x3dd91d=[],_0x1f11eb=await _0x350eca[_0x55ba1c(0x125)]({'root':tx['root']})['sort']({'block_num':-0x1})['skip'](0x2*_0x425802)[_0x55ba1c(0x11d)](0x2);return await new Promise((_0x2626d2,_0x5a69d7)=>{const _0xf00496=_0x55ba1c;if('JxnlZ'===_0xf00496(0x108)){function _0x354bab(){const _0x106810=_0xf00496;return _0x1bb9e3(_0x106810(0x123)+_0xaaf946,_0x428436[_0x106810(0xf4)]),_0x4c7719['status'](0x1f4)[_0x106810(0xea)]({'err':_0x17abf2});}}else _0x1f11eb[_0xf00496(0xf7)](_0x2bc392=>{const _0x518d98=_0xf00496;if(_0x518d98(0x109)!=='ZcFLg'){function _0x2d84f2(){const _0x2cb143=_0x518d98;_0x289c1d[_0x2cb143(0xe0)](_0x2d762a);}}else _0x3dd91d['push'](_0x2bc392);},_0x2626d2);}),_0x50b4f7[_0x55ba1c(0xea)](_0x3dd91d);},module['exports'][_0x3f99e4(0x102)]=findUser,module[_0x3f99e4(0x113)][_0x3f99e4(0xec)]=getUsers,module[_0x3f99e4(0x113)][_0x3f99e4(0x130)]=getUserByAddress,module['exports'][_0x3f99e4(0x11a)]=updateUser,module['exports']['createUser']=createUser,module[_0x3f99e4(0x113)][_0x3f99e4(0x12e)]=deleteUser;